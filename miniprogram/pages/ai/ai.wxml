<view class="container">
  <scroll-view class="chat-container" scroll-y scroll-into-view="{{scrollToView}}">
    <view class="message-list">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="msg-{{index}}" class="message-item">
          <view class="message-content {{item.sender_type === 'user' ? 'user-message' : ''}}">
            <image class="avatar" src="{{item.sender_type === 'user' ? (userInfo.avatar || '/images/default-avatar.png') : '/images/ai-avatar.png'}}" mode="aspectFill" />
            <view class="message-bubble {{item.sender_type === 'user' ? 'user-bubble' : 'ai-bubble'}}">
              <block wx:if="{{item.message_type === 'image'}}">
                <image class="message-image" src="{{item.image_url}}" mode="widthFix" bindtap="previewImage" data-url="{{item.image_url}}" />
              </block>
              <block wx:elif="{{item.message_type === 'text'}}">
                <text class="message-text">{{item.content}}</text>
              </block>
              <text class="message-time">{{formatTime(item.created_at)}}</text>
            </view>
          </view>
        </view>
      </block>
      <view class="typing-indicator" wx:if="{{isTyping}}">
        <view class="typing-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>
    </view>
  </scroll-view>

  <view class="quick-actions" wx:if="{{showQuickActions}}">
    <view class="action-list">
      <view class="action-item" bindtap="sendQuickMessage" data-text="ç»™æˆ‘åˆ¶å®šä¸€ä¸ªå‡é‡è®¡åˆ’">
        <text class="action-icon">ğŸ“</text>
        <text class="action-text">åˆ¶å®šè®¡åˆ’</text>
      </view>
      <view class="action-item" bindtap="sendQuickMessage" data-text="å¸®æˆ‘åˆ†æä»Šå¤©çš„é¥®é£Ÿè¥å…»">
        <text class="action-icon">ğŸ½ï¸</text>
        <text class="action-text">é¥®é£Ÿåˆ†æ</text>
      </view>
      <view class="action-item" bindtap="sendQuickMessage" data-text="æ¨èä¸€å¥—å…¥é—¨è¿åŠ¨æ–¹æ¡ˆ">
        <text class="action-icon">ğŸƒ</text>
        <text class="action-text">è¿åŠ¨æ¨è</text>
      </view>
    </view>
  </view>

  <view class="input-container">
    <view class="input-wrapper">
      <view class="function-buttons">
        <view class="function-btn" bindtap="toggleQuickActions">
          <image src="/images/icon-quick.png" mode="aspectFit" />
        </view>
        <view class="function-btn" bindtap="takePhoto">
          <image src="/images/icon-camera.png" mode="aspectFit" />
        </view>
        <view class="function-btn" bindtap="chooseImage">
          <image src="/images/icon-gallery.png" mode="aspectFit" />
        </view>
      </view>

      <view class="input-field-wrapper">
        <textarea class="input-field" value="{{inputText}}" placeholder="å’ŒAIé¡¾é—®èŠç‚¹ä»€ä¹ˆå§..." show-confirm-bar="false" adjust-position="true" auto-height bindinput="onInputChange" />
        <view class="input-counter">
          <text class="counter-text">{{dailyChatCount}} / {{maxDailyChatCount}}</text>
        </view>
      </view>

      <view class="send-btn" bindtap="sendMessage">
        <image src="/images/icon-send.png" mode="aspectFit" />
      </view>
    </view>
  </view>

  <view class="member-tip" wx:if="{{showMemberTip}}">
    <view class="tip-content">
      <text class="tip-text">ä»Šæ—¥AIå¯¹è¯æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œå‡çº§ä¼šå‘˜å¯äº«æ›´å¤šæ¬¡æ•°</text>
      <button class="btn btn-small" bindtap="upgradeMember">å»å‡çº§</button>
    </view>
  </view>
</view>